"""
Script: 02_entropy_analysis.py
Description: Calculates Shannon entropy for each amino acid in the MSA.
Usage: python 05_entropy_analysis.py
"""
from Bio import AlignIO
import math

def shannon_entropy(column):
    counts = {}
    for aa in column:
        if aa not in ['-', 'X', 'B', 'J', 'Z']:
            counts[aa] = counts.get(aa, 0) + 1
    total = sum(counts.values())
    if total == 0:
        return 0.0
    entropy = -sum((n / total) * math.log2(n / total) for n in counts.values())
    return entropy

aln = AlignIO.read("../data/processed/combined_HA_aligned.fa", "fasta")
L = aln.get_alignment_length()
with open("../results/tables/HA_shannon_entropy.tsv", "w") as out:
    out.write("pos\tentropy\n")
    for i in range(L):
        col = aln[:, i]
        H = shannon_entropy(col)
        out.write(f"{i+1}\t{H:.4f}\n")
print("Done! Output written to ../results/tables/HA_shannon_entropy.tsv")
